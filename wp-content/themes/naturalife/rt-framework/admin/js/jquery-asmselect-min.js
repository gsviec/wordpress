/*!
 * Alternate Select Multiple (asmSelect) 1.0.4a beta - jQuery Plugin
 * http://www.ryancramer.com/projects/asmselect/
 * 
 * Copyright (c) 2009 by Ryan Cramer - http://www.ryancramer.com
 * 
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 */
!function(a){a.fn.asmSelect=function(b){var c={listType:"ol",sortable:!1,highlight:!1,animate:!1,addItemTarget:"bottom",hideWhenAdded:!1,debugMode:!1,removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",containerClass:"asmContainer",selectClass:"asmSelect",optionDisabledClass:"asmOptionDisabled",listClass:"asmList",listSortableClass:"asmListSortable",listItemClass:"asmListItem",listItemLabelClass:"asmListItemLabel",removeClass:"asmListItemRemove",highlightClass:"asmHighlight"};return a.extend(c,b),this.each(function(b){function d(){for(;a("#"+c.containerClass+b).size()>0;)b++;u=a("<select></select>").addClass(c.selectClass).attr("name",c.selectClass+b).attr("id",c.selectClass+b),$selectRemoved=a("<select></select>"),v=a("<"+c.listType+"></"+c.listType+">").addClass(c.listClass).attr("id",c.listClass+b),t=a("<div></div>").addClass(c.containerClass).attr("id",c.containerClass+b),i(),u.change(f).click(g),w.change(h).wrap(t).before(u).before(v),c.sortable&&e(),a.browser.msie&&a.browser.version<8&&v.css("display","inline-block")}function e(){v.sortable({items:"li."+c.listItemClass,handle:"."+c.listItemLabelClass,axis:"y",update:function(){var b;a(this).children("li").each(function(){return $option=a("#"+a(this).attr("rel")),a(this).is(".ui-sortable-helper")?void(b=$option.attr("id")):void w.append($option)}),b&&s(b,"sort")}}).addClass(c.listSortableClass)}function f(){if(!(a.browser.msie&&a.browser.version<7)||y){var b=a(this).children("option:selected").slice(0,1).attr("rel");n(b),y=!1,s(b,"add")}}function g(){y=!0}function h(){return z?void(z=!1):(u.empty(),v.empty(),i(),void(a.browser.opera&&v.hide().fadeIn("fast")))}function i(){x=!0,u.prepend("<option>"+w.attr("title")+"</option>"),w.children("option").each(function(c){var d,e=a(this);e.attr("id")||e.attr("id","asm"+b+"option"+c),d=e.attr("id"),e.is(":selected")?(n(d),j(d,!0)):j(d)}),c.debugMode||w.hide(),k(),x=!1}function j(b,c){if(void 0==c)var c=!1;var d=a("#"+b),e=a("<option>"+d.text()+"</option>").val(d.val()).attr("rel",b);c&&l(e),u.append(e)}function k(){u.children(":eq(0)").attr("selected",!0)}function l(b){b.addClass(c.optionDisabledClass).attr("selected",!1).attr("disabled",!0),c.hideWhenAdded&&b.hide(),a.browser.msie&&u.hide().show()}function m(b){b.removeClass(c.optionDisabledClass).attr("disabled",!1),c.hideWhenAdded&&b.show(),a.browser.msie&&u.hide().show()}function n(b){var d=a("#"+b);if(d){var e=a("<a></a>").attr("href","#").addClass(c.removeClass).prepend(c.removeLabel).click(function(){return p(a(this).parent("li").attr("rel")),!1}),f=a("<span></span>").addClass(c.listItemLabelClass).html(d.html()),g=a("<li></li>").attr("rel",b).addClass(c.listItemClass).append(f).append(e).hide();if(!x){if(d.is(":selected"))return;d.attr("selected",!0)}"top"!=c.addItemTarget||x?(v.append(g),c.sortable&&w.append(d)):(v.prepend(g),c.sortable&&w.prepend(d)),o(g),l(a("[rel="+b+"]",u)),x||(r(g,c.highlightAddedLabel),k(),c.sortable&&v.sortable("refresh"))}}function o(a){c.animate&&!x?a.animate({opacity:"show",height:"show"},100,"swing",function(){a.animate({height:"+=2px"},50,"swing",function(){a.animate({height:"-=2px"},25,"swing")})}):a.show()}function p(b,d){if(void 0==d)var d=!0;var e=a("#"+b);e.attr("selected",!1),$item=v.children("li[rel="+b+"]"),q($item),m(a("[rel="+b+"]",c.removeWhenAdded?$selectRemoved:u)),d&&r($item,c.highlightRemovedLabel),s(b,"drop")}function q(a){c.animate&&!x?($prevItem=a.prev("li"),a.animate({opacity:"hide",height:"hide"},100,"linear",function(){$prevItem.animate({height:"-=2px"},50,"swing",function(){$prevItem.animate({height:"+=2px"},100,"swing")}),a.remove()})):a.remove()}function r(d,e){if(c.highlight){u.next("#"+c.highlightClass+b).remove();var f=a("<span></span>").hide().addClass(c.highlightClass).attr("id",c.highlightClass+b).html(e+d.children("."+c.listItemLabelClass).slice(0,1).text());u.after(f),f.fadeIn("fast",function(){setTimeout(function(){f.fadeOut("slow")},50)})}}function s(b,c){z=!0,$option=a("#"+b),w.trigger("change",[{option:$option,value:$option.val(),id:b,item:v.children("[rel="+b+"]"),type:c}])}var t,u,v,w=a(this),x=!1,y=!1,z=!1;d()})}}(jQuery);